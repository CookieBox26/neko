name: CI

on:
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch source via git
        env:
          TOKEN: ${{ github.token }}
        run: |
          git init .
          git remote add origin "https://x-access-token:${TOKEN}@github.com/${{ github.repository }}.git"
          git fetch --no-tags --depth=1 origin ${{ github.sha }}
          git checkout --detach FETCH_HEAD
      - name: Install uv
        run: pipx install uv
      - name: Sync dependencies
        run: uv sync
      - name: Run tests
        run: uv run pytest
